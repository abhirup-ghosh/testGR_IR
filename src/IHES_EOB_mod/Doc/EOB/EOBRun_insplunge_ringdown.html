<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of EOBRun_insplunge_ringdown</title>
  <meta name="keywords" content="EOBRun_insplunge_ringdown">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">EOB</a> &gt; EOBRun_insplunge_ringdown.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for EOB&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>EOBRun_insplunge_ringdown
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = EOBRun_insplunge_ringdown( nu,ainput, ... % a1,a2,a3,a4,a5,a6 (rem: a1...a4 multipolar!) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="EOBAdiabLSO.html" class="code" title="function LSO = EOBAdiabLSO(nu, EOBopt)">EOBAdiabLSO</a>	EOBAdiabLSO Compute Last-Stable-Orbit (LSO) in the EOB formalism.</li><li><a href="EOBExtractAPO.html" class="code" title="function varargout = EOBExtractAPO(hlm,t)">EOBExtractAPO</a>	EOBExtractAPO Compute amplitude, phase and frequency of waveform.</li><li><a href="EOBFluxHorizonFitCoefs.html" class="code" title="function c = EOBFluxHorizonFitCoefs(nu, EOBopt)">EOBFluxHorizonFitCoefs</a>	EOBFluxHorizonFitCoefs Coefficients for hybrid expression of rho_lm22 at the horizon.</li><li><a href="EOBHam.html" class="code" title="function varargout = EOBHam(nu, r,pph,prstar, EOBopt, varargin)">EOBHam</a>	EOBHam Computes the EOB real and effective Hamiltonian for EOB dynamics</li><li><a href="EOBHam0.html" class="code" title="function varargout = EOBHam0(nu, r,pph,prstar, EOBopt, varargin)">EOBHam0</a>	EOBHam0 Computes the EOB real and effective Hamiltonian for particle</li><li><a href="EOBIdPostAdiab.html" class="code" title="function y0 = EOBIdPostAdiab( nu, r0, EOBopt )">EOBIdPostAdiab</a>	EOBIdPostAdiab Provides initial data in post-post-circular approximation for</li><li><a href="EOBIdPostAdiab0.html" class="code" title="function y0 = EOBIdPostAdiab0( nu, r0, EOBopt )">EOBIdPostAdiab0</a>	EOBIdPostAdiab0 Provides initial data in post-circular (or post-adiabatic)</li><li><a href="EOBMetric.html" class="code" title="function varargout = EOBMetric( nu, r, EOBopt, varargin )">EOBMetric</a>	EOBMetric Computes the EOB metric potentials and derivatives.</li><li><a href="EOBNQCab0.html" class="code" title="function [a,b]=EOBNQCab0(EOBopt)">EOBNQCab0</a>	EOBNQCabFit Coefficients for NQC in the test-mass limit</li><li><a href="EOBNQCabFit.html" class="code" title="function [a,b] = EOBNQCabFit(nu, EOBopt)">EOBNQCabFit</a>	EOBNQCabFit Coefficients for NQC as fitted function of nu.</li><li><a href="EOBOmgE.html" class="code" title="function [Omega E pr Heff] = EOBOmgE(nu, r,pph,prstar, EOBopt, varargin)">EOBOmgE</a>	EOBOmgE Computes Energy and orbital frequency along dynamics.</li><li><a href="EOBPotential.html" class="code" title="function W = EOBPotential(nu, r, j, EOBopt, varargin)">EOBPotential</a>	EOBPotential Compute the adiabatic EOB effective potential.</li><li><a href="EOBQNMKerrFit.html" class="code" title="function sigma = EOBQNMKerrFit(nqnm,lmax, L,M,abh, datadir)">EOBQNMKerrFit</a>	EOBQNMKerrFit Fit to the perturbative QNM sigma's.</li><li><a href="EOBRRDIN.html" class="code" title="function [Fphi, Frstar] = EOBRRDIN(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRDIN</a>	EOBRRDIN Compute radiation reaction with resummed flux.</li><li><a href="EOBRRDIN0.html" class="code" title="function [Fphi, Frstar] = EOBRRDIN0(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRDIN0</a>	EOBRRDIN0 Compute radiation reaction with resummed flux for nu->0.</li><li><a href="EOBRRGeo.html" class="code" title="function [Fphi, Frstar] = EOBRRGeo(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRGeo</a>	EOBRRno Compute radiation reaction for geodesic motion (dummy routine).</li><li><a href="EOBRRNewt.html" class="code" title="function [Fphi, Frstar] = EOBRRNewt(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRNewt</a>	EOBRRno Compute radiation reaction for generic orbits at Newtonian order.</li><li><a href="EOBRRPN.html" class="code" title="function [Fphi, Frstar] = EOBRRPN(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRPN</a>	EOBRRno Compute radiation reaction with PN-Taylor flux.</li><li><a href="EOBRhs.html" class="code" title="function dydt = EOBRhs(t,y, nu, EOBopt)">EOBRhs</a>	EOBRhs Compute r.h.s. of the full EOB equations.</li><li><a href="EOBRhs0.html" class="code" title="function dydt = EOBRhs0(t,y, nu, EOBopt)">EOBRhs0</a>	EOBRhs0 Compute r.h.s. of the full EOB equations in the particle limit (nu<<1).</li><li><a href="EOBRhsCons.html" class="code" title="function dydt = EOBRhsCons(t,y, nu, EOBopt, varargin)">EOBRhsCons</a>	EOBRhs Compute conservative r.h.s. of the full EOB equations.</li><li><a href="EOBSet.html" class="code" title="function options = EOBSet(varargin)">EOBSet</a>	EOBSet Create/alter EOB OPTIONS structure.</li><li><a href="EOBStop.html" class="code" title="function [value,isterminal,direction] = EOBStop(t,y, rmin)">EOBStop</a>	EOBStop Event function to stop EOB integration.</li><li><a href="EOBddotrBoot2.html" class="code" title="function [ddotr dr_dt] = EOBddotrBoot2(nu,y,dydt,EOBopt,EOBmet,EOBHam)">EOBddotrBoot2</a>	EOBddotrBoot2.m Computes an approximate value for \ddot{r}.</li><li><a href="EOBddotrNoFlux.html" class="code" title="function [ddotr dr_dt dprstar_dt] = EOBddotrNoFlux(nu,y,dydt,EOBopt,EOBmet,EOBHam)">EOBddotrNoFlux</a>	EOBddotrBoot2.m Computes an approximate value for \ddot{r}.</li><li><a href="EOBhlm.html" class="code" title="function varargout = EOBhlm(nu, t,phi,r,pph,prstar, Omega,E,Heff, EOBopt, EOBmet)">EOBhlm</a>	EOBhlm Compute the multipolar resummed waveform.</li><li><a href="EOBhlmQNMMatch_no_dpsilm.html" class="code" title="function varargout = EOBhlmQNMMatch_no_dpsilm(Omega,t, sigma, nqnm, dt, wav )">EOBhlmQNMMatch_no_dpsilm</a>	EOBhlmQNMMatch Perform the matching to QNM multipolar wave.</li><li><a href="FDdrvt.html" class="code" title="function [d1f, d2f] = FDdrvt(f,t, varargin)">FDdrvt</a>	FDdrvt Compute finite differences of the function f(t).</li><li><a href="FindMax.html" class="code" title="function [xm,fm,dfm] = FindMax(x,f,n)">FindMax</a>	FindMax Compute extremum of f(x)</li><li><a href="LagInt1d.html" class="code" title="">LagInt1d</a>	LAGINT1D Lagrangian interpolation routine of 1d data</li><li><a href="Multipidx.html" class="code" title="function [LM2K, L,M] = Multipidx(lmax)">Multipidx</a>	MULTIPIDX Compute maps between multipolar indexes.</li><li><a href="PrintSFields.html" class="code" title="function PrintSFields( s, fid )">PrintSFields</a>	PrintSFields print fields of a structure and their content</li><li><a href="SetVOutput.html" class="code" title="function vout = SetVOutput( n, varargin )">SetVOutput</a>	SetVOutput Manage variables in output.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="Example_EOBRunq1_insplunge_ringdown.html" class="code" title="">Example_EOBRunq1_insplunge_ringdown</a>	Main example of EOB run</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = EOBRun_insplunge_ringdown( nu, </a><span class="keyword">...</span>
0002     ainput, <span class="keyword">...</span><span class="comment"> % a1,a2,a3,a4,a5,a6 (rem: a1...a4 multipolar!)</span>
0003     r0, tmax, dt, nqnm,lmaxqnm, <span class="keyword">...</span>
0004     varargin)
0005 
0006 <span class="comment">%EOBRun Run EOB simulation.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%   DATA = EOBRun( nu, a, r0, tmax,dt, nqnm,lmaxqnm ) perform EOB</span>
0009 <span class="comment">%   run with default options (see EOBSet.m) and parameters</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%    nu      : symmetric mass ratio (scalar)</span>
0012 <span class="comment">%    a       : a{1} ,..., a{4}, a{5}, a{6} NQC parameters for the</span>
0013 <span class="comment">%    multipolar waveform and deformation paramters (1x6 cell array</span>
0014 <span class="comment">%    of vectors)</span>
0015 <span class="comment">%    r0      : initial value of EOB radius</span>
0016 <span class="comment">%    tmax    : final time for dynamics</span>
0017 <span class="comment">%    dt      : time spacing output</span>
0018 <span class="comment">%    nqnm    : number of positive and negative QNM (vector size=2)</span>
0019 <span class="comment">%    lmaxqnm : max l-value to be used in QNM match (scalar)</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%   Return a data structure with dynamics and waveform.</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%   DATA = EOBRun( ... , lmaxqnm, EOBOPTIONS ) specify options from</span>
0024 <span class="comment">%   structure EOBOPTIONS (see EOBSet.m)</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   DATA = EOBRun( ... , lmaxqnm, [], modus ) specify modus</span>
0027 <span class="comment">%   operandi</span>
0028 <span class="comment">%             0 = dynamics</span>
0029 <span class="comment">%             1 = dynamics + inspl wave</span>
0030 <span class="comment">%             2 = dynamics + inspl-merg wave</span>
0031 <span class="comment">%             3 = dynamics + inspl-merg-ringdown wave (default)</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%   DATA = EOBRun( ... , lmaxqnm, [],[], verbose ) screen info</span>
0034 <span class="comment">%   level</span>
0035 <span class="comment">%             0 = minimum text (default)</span>
0036 <span class="comment">%             1 = text</span>
0037 <span class="comment">%             2 = text + figures</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   DATA = EOBRun( ... , lmaxqnm, [],[],[], saveme ) save data 0 =</span>
0040 <span class="comment">%   no 1 = yes (default)</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%   DATA = EOBRun( ... , lmaxqnm, [],[],[],[], basedir ) specify</span>
0043 <span class="comment">%   output directory, default = 'mydata'.</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%   [dyn,wav] = EOBRun( ... ) Return structures with dynamics and</span>
0046 <span class="comment">%   waveform seprately.</span>
0047 <span class="comment">%</span>
0048 
0049 
0050 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0051 <span class="comment">% Settings</span>
0052 
0053 fprintf(<span class="string">'===&gt; EOB run\n'</span>);
0054 tottime = tic;
0055 
0056 <span class="comment">% Manage args in</span>
0057 EOBopt  = [];                      <span class="comment">% struct of options (EOBSet.m)</span>
0058 modus   = 3;                       <span class="comment">%</span>
0059 verbose = 0;                       <span class="comment">% do not print info</span>
0060 saveme  = 1;                       <span class="comment">% do save results</span>
0061 basedir = <span class="string">'mydata/'</span>;
0062 
0063 optargs = {EOBopt modus verbose saveme basedir modus};
0064 na = length(varargin);
0065 <span class="keyword">if</span> (na&gt;6)
0066     error(<span class="string">'too many input args'</span>)
0067 <span class="keyword">end</span>
0068 newvals = cellfun(@(x) ~isempty(x), varargin);
0069 optargs(newvals) = varargin(newvals);
0070 [EOBopt, modus, verbose, saveme, basedir] = optargs{:};
0071 
0072 <span class="comment">% Set default EOB options</span>
0073 defaultopt = <a href="EOBSet.html" class="code" title="function options = EOBSet(varargin)">EOBSet</a>(<span class="keyword">...</span>
0074     <span class="string">'Dynamics'</span>,<span class="string">'eob'</span>,<span class="keyword">...</span>
0075     <span class="string">'RadReac'</span>,<span class="string">'din'</span>,<span class="keyword">...</span>
0076     <span class="string">'ddotrMethodDyn'</span>,<span class="string">'noflux'</span>,<span class="keyword">...</span>
0077     <span class="string">'ddotrMethodWav'</span>,<span class="string">'noflux'</span>,<span class="keyword">...</span>
0078     <span class="string">'HorizonFlux'</span>,<span class="string">'yes'</span>,<span class="keyword">...</span>
0079     <span class="string">'RadialFlux'</span>,<span class="string">'yes'</span>,<span class="keyword">...</span>
0080     <span class="string">'FIterms'</span>,<span class="string">'yes'</span>,<span class="keyword">...</span>
0081     <span class="string">'rholmarg'</span>,<span class="string">'v_phi'</span>,<span class="keyword">...</span>
0082     <span class="string">'PNorder'</span>,<span class="string">'5pnlog'</span>,<span class="keyword">...</span>
0083     <span class="string">'resumD'</span>,<span class="string">'pade03'</span>,<span class="keyword">...</span>
0084     <span class="string">'resumf22'</span>,<span class="string">'no'</span>,<span class="keyword">...</span>
0085     <span class="string">'Tidal'</span>,<span class="string">'no'</span>,<span class="keyword">...</span>
0086     <span class="string">'PNTidal'</span>,<span class="string">'nnlo'</span>,<span class="keyword">...</span>
0087     <span class="string">'NewtonWaves'</span>,<span class="string">'no'</span>,<span class="keyword">...</span>
0088     <span class="string">'DetermineNQCab'</span>,<span class="string">'no'</span>,<span class="keyword">...</span><span class="comment">    </span>
0089     <span class="string">'NQCFileNR'</span>,<span class="string">'../DataNR/NRpts4NQC.dat'</span>,<span class="keyword">...</span>
0090     <span class="string">'QNMDataDir'</span>,<span class="string">'../DataQNMs/'</span>,<span class="keyword">...</span>
0091     <span class="string">'textend'</span>,500,<span class="keyword">...</span>
0092     <span class="string">'ODEEventFunRmin'</span>,1.0,<span class="keyword">...</span>
0093     <span class="string">'ODESolverRelTol'</span>,1e-9,<span class="keyword">...</span>
0094     <span class="string">'ODESolverAbsTol'</span>,1e-12,<span class="keyword">...</span>
0095     <span class="string">'ODESolverRefine'</span>,1);
0096 
0097 <span class="comment">% Overwrite EOB options</span>
0098 EOBopt = <a href="EOBSet.html" class="code" title="function options = EOBSet(varargin)">EOBSet</a>(defaultopt, EOBopt );
0099 
0100 <span class="comment">% Lower the string entries in EOBoptions</span>
0101 Name   = fieldnames(EOBopt);
0102 idx    = strcmp(cellfun(@(x) class(EOBopt.(x)),Name,<span class="string">'UniformOutput'</span>,0),<span class="string">'char'</span>);
0103 EOBopt = cellfun(@(x) setfield(EOBopt,x,lower(EOBopt.(x))),Name(idx));
0104 EOBopt = EOBopt(1);
0105 
0106 
0107 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0108 <span class="comment">% Initialize run</span>
0109 
0110 fprintf(<span class="string">' ===&gt; Init run\n'</span>);
0111 tstart = tic;
0112 
0113 <span class="comment">% Compute multipolar indexes</span>
0114 lmax = 8;
0115 [LM2K, L,M] = <a href="Multipidx.html" class="code" title="function [LM2K, L,M] = Multipidx(lmax)">Multipidx</a>(lmax);
0116 
0117 EOBopt.LM2K = LM2K;
0118 EOBopt.L    = L;
0119 EOBopt.M    = M;
0120 
0121 kmax = length(L);
0122 
0123 <span class="comment">% Store dynamics pars</span>
0124 EOBopt.a5  = ainput{5};
0125 EOBopt.a6  = ainput{6};
0126 
0127 <span class="comment">% Set function handles</span>
0128 <span class="keyword">switch</span> EOBopt.Dynamics
0129     <span class="keyword">case</span> <span class="string">'eob'</span>
0130         EOBopt.ComputeEOBHam = @<a href="EOBHam.html" class="code" title="function varargout = EOBHam(nu, r,pph,prstar, EOBopt, varargin)">EOBHam</a>;
0131         EOBopt.ComputeRhs    = @<a href="EOBRhs.html" class="code" title="function dydt = EOBRhs(t,y, nu, EOBopt)">EOBRhs</a>;
0132         EOBopt.ComputeID     = @<a href="EOBIdPostAdiab.html" class="code" title="function y0 = EOBIdPostAdiab( nu, r0, EOBopt )">EOBIdPostAdiab</a>;                
0133     <span class="keyword">case</span> <span class="string">'particle'</span>
0134         EOBopt.ComputeEOBHam = @<a href="EOBHam0.html" class="code" title="function varargout = EOBHam0(nu, r,pph,prstar, EOBopt, varargin)">EOBHam0</a>;
0135         EOBopt.ComputeRhs    = @<a href="EOBRhs0.html" class="code" title="function dydt = EOBRhs0(t,y, nu, EOBopt)">EOBRhs0</a>;
0136         EOBopt.ComputeID     = @<a href="EOBIdPostAdiab0.html" class="code" title="function y0 = EOBIdPostAdiab0( nu, r0, EOBopt )">EOBIdPostAdiab0</a>;        
0137     <span class="keyword">otherwise</span>
0138         error(<span class="string">'unknown option %s for Dynamics.'</span>,EOBopt.Dynamics);
0139 <span class="keyword">end</span>
0140 
0141 <span class="keyword">switch</span> EOBopt.RadReac
0142     <span class="keyword">case</span> <span class="string">'din'</span>
0143         <span class="keyword">if</span> strcmp(EOBopt.Dynamics,<span class="string">'particle'</span>)
0144             EOBopt.ComputeRRForce = @<a href="EOBRRDIN0.html" class="code" title="function [Fphi, Frstar] = EOBRRDIN0(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRDIN0</a>;
0145         <span class="keyword">else</span>
0146             EOBopt.ComputeRRForce = @<a href="EOBRRDIN.html" class="code" title="function [Fphi, Frstar] = EOBRRDIN(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRDIN</a>;
0147         <span class="keyword">end</span>        
0148     <span class="keyword">case</span> <span class="string">'pn'</span>
0149             EOBopt.ComputeRRForce = @<a href="EOBRRPN.html" class="code" title="function [Fphi, Frstar] = EOBRRPN(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRPN</a>;
0150     <span class="keyword">case</span> <span class="string">'newt'</span>    
0151         EOBopt.ComputeRRForce = @<a href="EOBRRNewt.html" class="code" title="function [Fphi, Frstar] = EOBRRNewt(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRNewt</a>;
0152     <span class="keyword">case</span> <span class="string">'geo'</span>
0153         EOBopt.ComputeRRForce = @<a href="EOBRRGeo.html" class="code" title="function [Fphi, Frstar] = EOBRRGeo(nu, dydt, y, EOBopt, EOBmet, EOBHam)">EOBRRGeo</a>;
0154     <span class="keyword">otherwise</span>
0155         error(<span class="string">'unknown option %s for RadReac.'</span>,EOBopt.RadReac);
0156 <span class="keyword">end</span>
0157 
0158 <span class="keyword">switch</span> EOBopt.ddotrMethodDyn
0159     <span class="keyword">case</span> <span class="string">'boot2'</span>
0160         <span class="keyword">if</span> strcmp(EOBopt.Dynamics,<span class="string">'particle'</span>)
0161             EOBopt.Computeddotr = @EOBddotrBoot20;            
0162         <span class="keyword">else</span>
0163             EOBopt.Computeddotr = @<a href="EOBddotrBoot2.html" class="code" title="function [ddotr dr_dt] = EOBddotrBoot2(nu,y,dydt,EOBopt,EOBmet,EOBHam)">EOBddotrBoot2</a>;            
0164         <span class="keyword">end</span>
0165     <span class="keyword">case</span> <span class="string">'noflux'</span>
0166         EOBopt.Computeddotr = @<a href="EOBddotrNoFlux.html" class="code" title="function [ddotr dr_dt dprstar_dt] = EOBddotrNoFlux(nu,y,dydt,EOBopt,EOBmet,EOBHam)">EOBddotrNoFlux</a>;
0167     <span class="keyword">otherwise</span>
0168         error(<span class="string">'unknown option %s for ddotrMethodDyn.'</span>,EOBopt.ddotrMethodDyn);
0169 <span class="keyword">end</span>
0170 
0171 EOBopt.ODESolverEventF = @(t,y) <a href="EOBStop.html" class="code" title="function [value,isterminal,direction] = EOBStop(t,y, rmin)">EOBStop</a>(t,y, EOBopt.ODEEventFunRmin);
0172 
0173 <span class="comment">% Set options for ODE solver and time vector</span>
0174 ODEopt = odeset( <span class="string">'RelTol'</span>,EOBopt.ODESolverRelTol,<span class="keyword">...</span>
0175     <span class="string">'AbsTol'</span>,EOBopt.ODESolverAbsTol,<span class="keyword">...</span>
0176     <span class="string">'Refine'</span>,EOBopt.ODESolverRefine,<span class="keyword">...</span>
0177     <span class="string">'Events'</span>,EOBopt.ODESolverEventF );
0178 
0179 <span class="comment">% Build time vector</span>
0180 <span class="comment">% NOTE: dt given as input is the width of the matching grid. The spacing between each</span>
0181 <span class="comment">%       point of the &quot;matching grid&quot; is given by dt/(#QNMs - 1).</span>
0182 <span class="comment">%       FIXME: this can be probably done just locally after the integration.</span>
0183 
0184 dt    = dt/(sum(nqnm)-1); 
0185 tspan = 0:dt:tmax;
0186 
0187 <span class="comment">% Init NQC</span>
0188 <span class="keyword">if</span> strcmp(EOBopt.DetermineNQCab,<span class="string">'yes'</span>) 
0189     <span class="comment">% Allocate memory</span>
0190     a{1} = zeros(1,kmax);
0191     a{2} = a{1};
0192     a{3} = a{1};
0193     b{1} = a{1};
0194     b{2} = a{1};
0195     b{3} = a{1};
0196     <span class="comment">% Set some for dynamics</span>
0197     <span class="comment">% a' and b's will be overwritten by the call EOBNQCabFind.m</span>
0198     a{1}(1:length(ainput{1})) = ainput{1};
0199     a{2}(1:length(ainput{2})) = ainput{2};
0200     a{3}(1:length(ainput{3})) = ainput{3};
0201     a{4}(1:length(ainput{4})) = ainput{4};
0202     <span class="keyword">if</span> exist(EOBopt.NQCFileNR,<span class="string">'file'</span>)
0203         NRPTS = importdata(EOBopt.NQCFileNR,<span class="string">' '</span>,3);
0204         NRPTS = NRPTS.data;
0205     <span class="keyword">else</span>
0206         error(<span class="string">'file %s does not exist'</span>,EOBopt.NQCFileNR);
0207     <span class="keyword">end</span>
0208 <span class="keyword">else</span>
0209   <span class="comment">% do not determine a's and b's</span>
0210   <span class="comment">% use pre-computed</span>
0211   <span class="keyword">if</span> strcmp(EOBopt.Dynamics,<span class="string">'particle'</span>)    
0212     [a,b] = <a href="EOBNQCab0.html" class="code" title="function [a,b]=EOBNQCab0(EOBopt)">EOBNQCab0</a>(EOBopt);
0213   <span class="keyword">else</span>
0214     [a,b] = <a href="EOBNQCabFit.html" class="code" title="function [a,b] = EOBNQCabFit(nu, EOBopt)">EOBNQCabFit</a>(nu, EOBopt);
0215   <span class="keyword">end</span>
0216 <span class="keyword">end</span>
0217 
0218 EOBopt.NQC.a = a;
0219 EOBopt.NQC.b = b;
0220 
0221 <span class="keyword">if</span> strcmp(lower(EOBopt.RadReac),<span class="string">'din'</span>) <span class="keyword">...</span>
0222         &amp;&amp; strcmp(lower(EOBopt.HorizonFlux),<span class="string">'yes'</span>)
0223     <span class="comment">% Init coefficients used in horizon flux</span>
0224     c = <a href="EOBFluxHorizonFitCoefs.html" class="code" title="function c = EOBFluxHorizonFitCoefs(nu, EOBopt)">EOBFluxHorizonFitCoefs</a>(nu, EOBopt);
0225     EOBopt.HorizonFluxCoefs.c = c;
0226 <span class="keyword">end</span>
0227 
0228 
0229 <span class="keyword">if</span> modus&lt;0 || modus &gt;3
0230     error(<span class="string">'unknown value for ''modus'' par, {0,1,2,3}'</span>);
0231 <span class="keyword">end</span>
0232 
0233 <span class="keyword">if</span> verbose&lt;0 || verbose &gt;2    
0234     error(<span class="string">'unknown value for ''verbose'' par, {0,1,2} =&gt; no, screen info, screen info and fig'</span>);
0235 <span class="keyword">end</span>
0236 fhIdx = 0; <span class="comment">% figures index</span>
0237 
0238 <span class="keyword">if</span> nqnm(2)&gt;nqnm(1) || nqnm(1)&lt;0
0239     error(<span class="string">'nQNM must have two entries, nQNM(1)&gt;=0 and nQNM(2)&lt;=nQNM(1)'</span>)
0240 <span class="keyword">end</span>
0241 
0242 <span class="comment">% Create output dirs (if necessary)</span>
0243 <span class="keyword">if</span> saveme
0244     
0245     basedir = strcat(basedir,<span class="string">'/'</span>);
0246     [ok,mess,messid] = mkdir(basedir);       
0247     <span class="keyword">if</span> ~ok, error(mess); <span class="keyword">end</span>;
0248     
0249     fid = fopen(strcat(basedir,<span class="string">'log.txt'</span>),<span class="string">'w'</span>);
0250     fprintf(fid,<span class="string">'%s\n Notes:\n'</span>,datestr(now, <span class="string">'mm/dd/yyyy HH:MM:SS'</span>));
0251     fclose(fid);
0252     
0253     <span class="keyword">if</span> verbose==2
0254         [ok,mess,messid] = mkdir(basedir,<span class="string">'Fig'</span>); <span class="keyword">if</span> ~ok, error(mess); <span class="keyword">end</span>;
0255     <span class="keyword">end</span>
0256     
0257 <span class="keyword">end</span>
0258 
0259 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0260 
0261 <span class="keyword">if</span> verbose
0262   <a href="PrintSFields.html" class="code" title="function PrintSFields( s, fid )">PrintSFields</a>(EOBopt,1);
0263 <span class="keyword">end</span>
0264 
0265 
0266 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0267 <span class="comment">% Initial data</span>
0268 
0269 fprintf(<span class="string">' ===&gt; Compute initial data for evolution\n'</span>);
0270 tstart = tic;
0271 y  = EOBopt.ComputeID(nu, r0, EOBopt );
0272 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0273 
0274 y0      = y(1:4); <span class="comment">% this goes into theDyn     ODE call</span>
0275 r0      = y0(2);
0276 pph0    = y0(3);
0277 prstar0 = y0(4);
0278 j0      = y(6);
0279 
0280 <span class="keyword">if</span> verbose
0281     fprintf(<span class="string">' r      = %+.12e\n'</span>,y0(2));
0282     fprintf(<span class="string">' pph    = %+.12e\n'</span>,y0(3));
0283     fprintf(<span class="string">' prstar = %+.12e\n'</span>,y0(4));
0284     fprintf(<span class="string">' pr     = %+.12e\n'</span>,y(5));
0285     fprintf(<span class="string">' j      = %+.12e\n'</span>,y(6)); 
0286 <span class="keyword">end</span>
0287 
0288 
0289 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0290 <span class="comment">% Adiabatic LSO, EOB potential and Hamiltonian (if required)</span>
0291 
0292 <span class="keyword">if</span> verbose
0293     
0294     fprintf(<span class="string">' ===&gt; Compute Adiabatic LSO\n'</span>);
0295     tstart = tic;
0296     LSO = <a href="EOBAdiabLSO.html" class="code" title="function LSO = EOBAdiabLSO(nu, EOBopt)">EOBAdiabLSO</a>(nu, EOBopt);
0297     fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));    
0298     
0299     fprintf(<span class="string">' Omega        [LSO Adiab] = %+.12e\n'</span>,LSO.Omega);
0300     fprintf(<span class="string">' omega22      [LSO Adiab] = %+.12e\n'</span>,LSO.w22);
0301     fprintf(<span class="string">' Omega   Newt [LSO Adiab] = %+.12e\n'</span>,LSO.Newt_Omega);
0302     fprintf(<span class="string">' omega22 Newt [LSO Adiab] = %+.12e\n'</span>,LSO.Newt_w22);
0303     fprintf(<span class="string">' r            [LSO Adiab] = %+.12e\n'</span>,LSO.r);
0304     fprintf(<span class="string">' u            [LSO Adiab] = %+.12e\n'</span>,LSO.u);
0305         
0306     fprintf(<span class="string">' ===&gt; Compute EOB metric, potential and Hamiltonian\n'</span>);
0307     tstart = tic;
0308     R          = 1.1:0.01:100;
0309     Metric     = <a href="EOBMetric.html" class="code" title="function varargout = EOBMetric( nu, r, EOBopt, varargin )">EOBMetric</a>( nu, R, EOBopt );
0310     Wadiab     = <a href="EOBPotential.html" class="code" title="function W = EOBPotential(nu, r, j, EOBopt, varargin)">EOBPotential</a>(nu, R, j0  , EOBopt, Metric );
0311     W          = <a href="EOBPotential.html" class="code" title="function W = EOBPotential(nu, r, j, EOBopt, varargin)">EOBPotential</a>(nu, R, pph0, EOBopt, Metric );
0312     [H0 Heff0] = EOBopt.ComputeEOBHam(nu, r0,pph0,prstar0, EOBopt);
0313     fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));    
0314     
0315     fprintf(<span class="string">' nu H0 = %+.12e\n'</span>,nu*H0);
0316     fprintf(<span class="string">' Heff0 = %+.12e\n'</span>,Heff0);
0317         
0318     <span class="keyword">if</span> verbose==2
0319         
0320         fhIdx  = fhIdx+1; fhName{fhIdx} = <span class="string">'Potential'</span>; fh(fhIdx) = figure;
0321         plot(R,W,<span class="string">'b-'</span>,R,Wadiab,<span class="string">'r--'</span>);
0322         hold on        
0323         <span class="keyword">if</span> strcmp(EOBopt.Dynamics,<span class="string">'particle'</span>)
0324             line([min(R) max(R)],[H0 H0],<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>);
0325         <span class="keyword">else</span>
0326             line([min(R) max(R)],[nu*H0 nu*H0],<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>);
0327         <span class="keyword">end</span>
0328         line([r0 r0],[min(W) max(W)],<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>);
0329         xlabel(<span class="string">'r'</span>);
0330         legend(<span class="string">'W[p_{\phi}(0)]'</span>,<span class="string">'W[j(0)]'</span>,1);
0331         title(<span class="string">'EOB potential'</span>)
0332         
0333     <span class="keyword">end</span>
0334     
0335 <span class="keyword">end</span>
0336 
0337 
0338 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0339 <span class="comment">% Evolve</span>
0340 
0341 fprintf(<span class="string">' ===&gt; Compute dynamics\n'</span>);
0342 tstart = tic;
0343 [t,y] = ode113(@(t,y) EOBopt.ComputeRhs(t,y, nu,EOBopt), tspan, y0, ODEopt);
0344 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0345 
0346 <span class="keyword">if</span> verbose
0347             
0348     <span class="keyword">if</span> verbose==2
0349         
0350         fhIdx  = fhIdx+1; fhName{fhIdx} = <span class="string">'Dyn_rt'</span>; fh(fhIdx) = figure;
0351         plot(t,y(:,2))
0352         xlabel(<span class="string">'t/M'</span>); ylabel(<span class="string">'r/M'</span>);
0353         title(<span class="string">'EOB dynamics r(t)'</span>)
0354         
0355         fhIdx  = fhIdx+1; fhName{fhIdx} = <span class="string">'Dyn_rphi'</span>; fh(fhIdx) = figure;
0356         polar(y(:,1),y(:,2))
0357         title(<span class="string">'EOB dynamics r(\phi)'</span>)
0358         
0359     <span class="keyword">end</span>
0360     
0361 <span class="keyword">end</span>
0362 
0363 
0364 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0365 <span class="comment">% Unpack and Extend variables (if necessary)</span>
0366 
0367 nt     = length(t);
0368 
0369 phi    = y(:,1);
0370 r      = y(:,2);
0371 pph    = y(:,3);
0372 prstar = y(:,4);
0373 
0374 text = EOBopt.textend;
0375 tdyn = t(end);
0376 
0377 text = [(tdyn+dt):dt:(tdyn+text)]';
0378 t    = [t; text];
0379 nt   = length(t);
0380 
0381 phi     = phi(end)   *ones(nt,1);
0382 r       = r(end)     *ones(nt,1);
0383 pph     = pph(end)   *ones(nt,1);
0384 prstar  = prstar(end)*ones(nt,1);
0385 
0386 Idx = (t&lt;=tdyn);
0387 phi(Idx)    = y(:,1);
0388 r(Idx)      = y(:,2);
0389 pph(Idx)    = y(:,3);
0390 prstar(Idx) = y(:,4);
0391 
0392 y = [phi r pph prstar]';
0393 
0394 
0395 
0396 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0397 <span class="comment">% Energy, angular momentum and frequency along the EOB dynamics</span>
0398 
0399 fprintf(<span class="string">' ===&gt; Compute energy, angular momentum and orbital frequency\n'</span>);
0400 tstart = tic;
0401 Metric            = <a href="EOBMetric.html" class="code" title="function varargout = EOBMetric( nu, r, EOBopt, varargin )">EOBMetric</a>( nu, r, EOBopt );
0402 [Omega E pr Heff] = <a href="EOBOmgE.html" class="code" title="function [Omega E pr Heff] = EOBOmgE(nu, r,pph,prstar, EOBopt, varargin)">EOBOmgE</a>( nu, r,pph,prstar, EOBopt, Metric );
0403 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0404 
0405 
0406 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0407 <span class="comment">% Derivatives of orbital frequency and ddotr</span>
0408 
0409 fprintf(<span class="string">' ===&gt; Compute derivatives of orbital frequency ...\n'</span>);
0410 tstart = tic;
0411 dotOmega = <a href="FDdrvt.html" class="code" title="function [d1f, d2f] = FDdrvt(f,t, varargin)">FDdrvt</a>(Omega,t,4).';
0412 A_Omg    = dotOmega./(96*nu/5*Omega.^(11/3));
0413 Q_Omg    = Omega.^2./dotOmega;
0414 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0415 
0416 fprintf(<span class="string">' ===&gt; Compute ddot r ...\n'</span>);
0417 <span class="keyword">switch</span> EOBopt.ddotrMethodWav
0418     <span class="keyword">case</span> <span class="string">'boot2'</span>
0419         Ham   = EOBopt.ComputeEOBHam(nu,r,pph,prstar,EOBopt,Metric);
0420         dydt  = <a href="EOBRhsCons.html" class="code" title="function dydt = EOBRhsCons(t,y, nu, EOBopt, varargin)">EOBRhsCons</a>(t,y, nu, EOBopt, Metric, Ham);
0421         ddotr = <a href="EOBddotrBoot2.html" class="code" title="function [ddotr dr_dt] = EOBddotrBoot2(nu,y,dydt,EOBopt,EOBmet,EOBHam)">EOBddotrBoot2</a>(nu, y,dydt, EOBopt, Metric, Ham);
0422     <span class="keyword">case</span> <span class="string">'noflux'</span>
0423         Ham   = EOBopt.ComputeEOBHam(nu,r,pph,prstar,EOBopt,Metric);
0424         dydt  = <a href="EOBRhsCons.html" class="code" title="function dydt = EOBRhsCons(t,y, nu, EOBopt, varargin)">EOBRhsCons</a>(t,y, nu, EOBopt, Metric, Ham);
0425         ddotr = <a href="EOBddotrNoFlux.html" class="code" title="function [ddotr dr_dt dprstar_dt] = EOBddotrNoFlux(nu,y,dydt,EOBopt,EOBmet,EOBHam)">EOBddotrNoFlux</a>(nu, y,dydt, EOBopt, Metric, Ham);
0426     <span class="keyword">case</span> <span class="string">'fd'</span>
0427         <span class="keyword">if</span> strcmp(EOBopt.Dynamics,<span class="string">'particle'</span>)
0428             dotr = Metric.A.*prstar./Heff;
0429         <span class="keyword">elseif</span> strcmp(EOBopt.PNorder,<span class="string">'1pn'</span>) || strcmp(EOBopt.PNorder,<span class="string">'2pn'</span>)
0430             dotr = sqrt(Metric.A ./ Metric.B).*prstar./(E.*Heff);
0431         <span class="keyword">else</span>
0432             dotr = sqrt(Metric.A./Metric.B).*(prstar + <span class="keyword">...</span>
0433                 4*nu*(4-3*nu)*Metric.A.*(1./r).^2.*prstar.^3)./(E.*Heff);
0434         <span class="keyword">end</span>
0435         ddotr = <a href="FDdrvt.html" class="code" title="function [d1f, d2f] = FDdrvt(f,t, varargin)">FDdrvt</a>(dotr,t,4);
0436     <span class="keyword">otherwise</span>
0437         error(<span class="string">'unknown option %s for ddotrMethodWav.'</span>,EOBopt.ddotrMethodWav);
0438 <span class="keyword">end</span>
0439 ddotr = reshape(ddotr,size(r));
0440 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0441 
0442 <span class="comment">% Pack dynamics</span>
0443 dyn.t      = t;
0444 dyn.r      = r;
0445 dyn.phi    = phi;
0446 dyn.pph    = pph;
0447 dyn.E      = E;
0448 dyn.e      = (E-1)/nu;
0449 dyn.prstar = prstar;
0450 dyn.pr     = pr;
0451 dyn.ddotr  = ddotr;
0452 dyn.Omg    = Omega;
0453 dyn.Heff   = Heff;
0454 dyn.dotOmg = dotOmega;
0455 dyn.A_Omg  = A_Omg;
0456 dyn.Q_Omg  = Q_Omg;
0457       
0458 
0459 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0460 <span class="comment">% LSO and LR crossing</span>
0461  
0462 fprintf(<span class="string">' ===&gt; Compute LSO and LR crossing\n'</span>);
0463 tstart = tic;
0464 
0465 <span class="comment">% Locate the crossing of adiabatic LSO position and write into LSO struct</span>
0466 <span class="comment">% NOTE: upper case vars are the dynamical ones !</span>
0467 idxLSO     = find(r &lt;= LSO.r,1,<span class="string">'last'</span>);
0468 LSO.idxLSO = idxLSO;
0469 LSO.T      = t(idxLSO);
0470 LSO.OMEGA  = Omega(idxLSO);
0471 LSO.R      = r(idxLSO);
0472 LSO.U      = 1/r(idxLSO);
0473 
0474 <span class="comment">% Locate the maximum of orbital frequency (EOB &quot;light-ring crossing&quot;)</span>
0475 [MaxOmega, idxLR] = max(Omega);
0476 
0477 jIdx = idxLR-5:idxLR+5;    
0478 [tmax,MaxOmega] = <a href="FindMax.html" class="code" title="function [xm,fm,dfm] = FindMax(x,f,n)">FindMax</a>( t(jIdx), Omega(jIdx), 2 );
0479 LR.idxLR   = idxLR;
0480 LR.OMEGA   = MaxOmega;
0481 LR.omega22 = 2 * MaxOmega;
0482 LR.T   = tmax;
0483 LR.R   = <a href="LagInt1d.html" class="code" title="">LagInt1d</a>( 4, t, r, tmax );
0484 LR.U   = 1/LR.R;
0485 LR.E   = <a href="LagInt1d.html" class="code" title="">LagInt1d</a>( 4, t, dyn.E  , tmax );
0486 LR.pph = <a href="LagInt1d.html" class="code" title="">LagInt1d</a>( 4, t, dyn.pph, tmax );
0487 
0488 <span class="comment">% Pack data</span>
0489 dyn.LSO = LSO;
0490 dyn.LR = LR;
0491 
0492 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0493 
0494 fprintf(<span class="string">' t            [LSO Dyn] = %+.12e\n'</span>,LSO.T);
0495 fprintf(<span class="string">' Omega        [LSO Dyn] = %+.12e\n'</span>,LSO.OMEGA);
0496 fprintf(<span class="string">' r            [LSO Dyn] = %+.12e\n'</span>,LSO.R);
0497 fprintf(<span class="string">' u            [LSO Dyn] = %+.12e\n'</span>,LSO.U);
0498 
0499 fprintf(<span class="string">' t            [LR]      = %+.12e\n'</span>,LR.T);
0500 fprintf(<span class="string">' Omega        [LR]      = %+.12e\n'</span>,LR.OMEGA);
0501 fprintf(<span class="string">' omega22      [LR]      = %+.12e\n'</span>,LR.omega22);
0502 fprintf(<span class="string">' r            [LR]      = %+.12e\n'</span>,LR.R);
0503 fprintf(<span class="string">' u            [LR]      = %+.12e\n'</span>,LR.U);
0504 fprintf(<span class="string">' E            [LR]      = %+.12e\n'</span>,LR.E);
0505 fprintf(<span class="string">' pph          [LR]      = %+.12e\n'</span>,LR.pph);
0506 
0507 <span class="keyword">if</span> verbose==2
0508 
0509     fhIdx  = fhIdx+1; fhName{fhIdx} = <span class="string">'EOBdyn_epph'</span>; fh(fhIdx) = figure;
0510     plot(pph,(E-1)/nu,<span class="string">'k'</span>)
0511     title(<span class="string">'Binding energy vs angular momentum'</span>);
0512     xlabel(<span class="string">'p_\phi'</span>);
0513     ylabel(<span class="string">'e = (E-1)/\nu'</span>);
0514 
0515 <span class="keyword">end</span>
0516 
0517 
0518 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0519 <span class="comment">% Save (if required) ... End here ?</span>
0520 
0521 <span class="keyword">if</span> saveme
0522     
0523     <span class="comment">% *.mat file(s)</span>
0524     fprintf(<span class="string">' ===&gt; Save *.mat files ...\n'</span>);
0525     tstart = tic;        
0526     
0527     filename  = strcat(basedir,<span class="string">'Settings'</span>);
0528     save(filename,<span class="string">'EOBopt'</span>);
0529     [err mess] = system(sprintf(<span class="string">'du -h %s.mat '</span>,filename));
0530     <span class="keyword">if</span> err, error(mess); <span class="keyword">end</span>;
0531     fprintf(<span class="string">' %s'</span>,mess);    
0532     
0533     filename  = strcat(basedir,<span class="string">'Dynamics'</span>);
0534     save(filename,<span class="string">'dyn'</span>);
0535     [err mess] = system(sprintf(<span class="string">'du -h %s.mat '</span>,filename));
0536     <span class="keyword">if</span> err, error(mess); <span class="keyword">end</span>;
0537     fprintf(<span class="string">' %s'</span>,mess);    
0538     
0539     fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0540     
0541     <span class="keyword">if</span> verbose==2
0542         <span class="comment">% *.fig(s)</span>
0543         fprintf(<span class="string">' ===&gt; Save *.fig files ...\n'</span>);
0544         <span class="keyword">for</span> k=1:fhIdx
0545             saveas(fh(k),strcat(basedir,<span class="string">'/Fig/'</span>,fhName{fhIdx}),<span class="string">'fig'</span>);
0546         <span class="keyword">end</span>        
0547         fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0548         <span class="comment">%close all;</span>
0549         fhIdx = 0;      
0550     <span class="keyword">end</span>
0551     
0552 <span class="keyword">end</span>
0553 
0554 <span class="keyword">if</span> modus==0
0555     varargout = <a href="SetVOutput.html" class="code" title="function vout = SetVOutput( n, varargin )">SetVOutput</a>( nargout, EOBopt,dyn );
0556     fprintf(<span class="string">'End %4.3f sec\n'</span>,toc(tottime));
0557     <span class="keyword">return</span>
0558 <span class="keyword">end</span>
0559 
0560 
0561 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0562 <span class="comment">% Insplunge waveform</span>
0563 
0564 fprintf(<span class="string">' ===&gt; Insplunge waveform ...\n'</span>);
0565 tstart = tic;
0566 wav = <a href="EOBhlm.html" class="code" title="function varargout = EOBhlm(nu, t,phi,r,pph,prstar, Omega,E,Heff, EOBopt, EOBmet)">EOBhlm</a>(nu, t,phi,r,pph,prstar, Omega,E,Heff, EOBopt, Metric);
0567 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0568 
0569 wav.t = t;
0570 
0571 <span class="keyword">if</span> verbose
0572   
0573     fprintf(<span class="string">' # of orbits     = %g\n'</span>,phi(end)/(2*pi));
0574 
0575     <span class="keyword">if</span> verbose==2
0576         
0577         fhIdx  = fhIdx+1; fhName{fhIdx} = <span class="string">'Wav_inspl'</span>; 
0578         fh(fhIdx) = figure(<span class="string">'Name'</span>,<span class="string">'Insplunge waveform'</span>);
0579         plot(t,abs(wav.psilm(LM2K(2,2),:)),<span class="string">'b-'</span>,<span class="keyword">...</span>
0580             t,wav.omglm(LM2K(2,2),:),<span class="string">'r--'</span>,<span class="keyword">...</span>
0581             t,Omega,<span class="string">'g-.'</span>)        
0582         title(<span class="string">'Insplunge waveform'</span>);
0583         xlabel(<span class="string">'t/M'</span>);
0584         ylim([0 0.56]);
0585         legend(<span class="string">'|\Psi_{22}|/\nu'</span>,<span class="string">'M\omega_{22}'</span>,<span class="string">'M\Omega'</span>);        
0586         
0587     <span class="keyword">end</span>
0588     
0589 <span class="keyword">end</span>
0590 
0591 
0592 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0593 <span class="comment">% Save (if required) ... End here ?</span>
0594 
0595 <span class="keyword">if</span> saveme
0596     
0597     fprintf(<span class="string">' ===&gt; Save *.mat files ...\n'</span>);
0598     tstart = tic;        
0599     
0600     filename  = strcat(basedir,<span class="string">'WavInspl'</span>);
0601     save(filename,<span class="string">'wav'</span>);
0602     [err,mess] = system(sprintf(<span class="string">'du -h %s.mat '</span>,filename));
0603     <span class="keyword">if</span> err, error(mess); <span class="keyword">end</span>;
0604     fprintf(<span class="string">' %s'</span>,mess);
0605     
0606     fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0607     
0608     <span class="keyword">if</span> verbose==2
0609         <span class="comment">% *.fig(s)</span>
0610         fprintf(<span class="string">' ===&gt; Save *.fig files ...\n'</span>);
0611         <span class="keyword">for</span> k=1:fhIdx
0612             saveas(fh(k),strcat(basedir,<span class="string">'/Fig/'</span>,fhName{fhIdx}),<span class="string">'fig'</span>);
0613         <span class="keyword">end</span>        
0614         fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0615         <span class="comment">%close all;</span>
0616         fhIdx = 0; 
0617     <span class="keyword">end</span>
0618     
0619 <span class="keyword">end</span>
0620 
0621 <span class="keyword">if</span> modus==1
0622     varargout = <a href="SetVOutput.html" class="code" title="function vout = SetVOutput( n, varargin )">SetVOutput</a>( nargout, EOBopt,dyn,wav );    
0623     fprintf(<span class="string">'End %4.3f sec\n'</span>,toc(tottime));
0624     <span class="keyword">return</span>
0625 <span class="keyword">end</span>
0626 
0627 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0628 <span class="comment">% Insplunge + ringdown waveform</span>
0629 
0630 <span class="comment">% Compute complex QNM frequencies</span>
0631 fprintf(<span class="string">' ===&gt; QNM frequencies ...\n'</span>);
0632 tstart = tic;
0633 Mbh = LR.E;
0634 abh = LR.pph*nu/Mbh^2;
0635 sigma = <a href="EOBQNMKerrFit.html" class="code" title="function sigma = EOBQNMKerrFit(nqnm,lmax, L,M,abh, datadir)">EOBQNMKerrFit</a>(nqnm(1),lmaxqnm, EOBopt.L,EOBopt.M,abh, EOBopt.QNMDataDir);
0636 <span class="keyword">if</span> nqnm(2)&gt;0
0637     sigma = [sigma conj(sigma(1:nqnm(2)))];
0638 <span class="keyword">end</span>
0639 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0640 
0641 fprintf(<span class="string">' ===&gt; Insplunge+merger+ringdown waveform ...\n'</span>);
0642 tstart = tic;
0643 sigma = sigma/Mbh; <span class="comment">% rescale units !</span>
0644 [psilm,omglm] = <a href="EOBhlmQNMMatch_no_dpsilm.html" class="code" title="function varargout = EOBhlmQNMMatch_no_dpsilm(Omega,t, sigma, nqnm, dt, wav )">EOBhlmQNMMatch_no_dpsilm</a>(Omega,t, sigma, nqnm, dt, wav );
0645 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0646 
0647 fprintf(<span class="string">' ===&gt; Update waveform ...\n'</span>);
0648 wav        = <a href="EOBExtractAPO.html" class="code" title="function varargout = EOBExtractAPO(hlm,t)">EOBExtractAPO</a>(psilm,t);  
0649 wav.t      = t;
0650 wav.psilm  = psilm;
0651 <span class="comment">%wav.dpsilm = dpsilm;</span>
0652 wav.omglm  = omglm;
0653 wav.hlm    = nell.*psilm;
0654 wav.A_omg  = wav.domglm./( cnu*wav.omglm.^(11/3) ) ;
0655 wav.Q_omg  = wav.omglm.^2./wav.domglm;
0656 wav.NQCa   = a; 
0657 wav.NQCb   = b; 
0658 fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0659 
0660 
0661 <span class="keyword">if</span> verbose
0662     
0663     fprintf(<span class="string">' Mbh      [LSO Dyn] = %+.12e\n'</span>,Mbh);
0664     fprintf(<span class="string">' abh      [LSO Dyn] = %+.12e\n'</span>,abh);    
0665 
0666     <span class="keyword">if</span> verbose==2
0667         
0668         fhIdx  = fhIdx+1; fhName{fhIdx} = <span class="string">'Wav_inspl'</span>; fh(fhIdx) = figure;
0669         plot(wav.t,abs(wav.psilm(LM2K(2,2),:)),<span class="string">'b-.'</span>,<span class="keyword">...</span><span class="comment">  </span>
0670             wav.t,real(wav.psilm(LM2K(2,2),:)),<span class="string">'b-'</span>,<span class="keyword">...</span><span class="comment">        </span>
0671             wav.t,wav.omglm(LM2K(2,2),:),<span class="string">'r--'</span>,<span class="keyword">...</span>
0672             wav.t,Omega,<span class="string">'g-.'</span>)
0673         title(<span class="string">'Insplunge+NQC+ringdown waveform'</span>);
0674         xlabel(<span class="string">'t/M'</span>);        
0675         legend(<span class="string">'|\psi_{22}|/\nu'</span>,<span class="string">'Re\psi_{22}/\nu'</span>,<span class="string">'\omega_{22}'</span>,<span class="string">'\Omega'</span>)
0676         
0677     <span class="keyword">end</span>
0678     
0679 <span class="keyword">end</span>
0680 
0681 
0682 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0683 <span class="comment">% Save (if required) and End</span>
0684 
0685 <span class="keyword">if</span> saveme
0686     
0687     fprintf(<span class="string">' ===&gt; Save *.mat files ...\n'</span>);
0688     tstart = tic;        
0689     
0690     <span class="comment">% *.mat file(s)</span>
0691     filename  = strcat(basedir,<span class="string">'WavInsplMergRing'</span>);
0692     save(filename,<span class="string">'wav'</span>);
0693     [err mess] = system(sprintf(<span class="string">'du -h %s.mat '</span>,filename));
0694     <span class="keyword">if</span> err, error(mess); <span class="keyword">end</span>;
0695     fprintf(<span class="string">' %s'</span>,mess);
0696     
0697     filename  = strcat(basedir,<span class="string">'FinalBH'</span>);
0698     save(filename,<span class="string">'Mbh'</span>,<span class="string">'abh'</span>,<span class="string">'sigma'</span>);
0699     [err mess] = system(sprintf(<span class="string">'du -h %s.mat '</span>,filename));
0700     <span class="keyword">if</span> err, error(mess); <span class="keyword">end</span>;
0701     fprintf(<span class="string">' %s'</span>,mess);
0702     
0703     fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0704 
0705     <span class="keyword">if</span> strcmp(EOBopt.DetermineNQCab,<span class="string">'yes'</span>)
0706         filename  = strcat(basedir,<span class="string">'NQCcorr'</span>);
0707         save(filename,<span class="string">'a'</span>,<span class="string">'b'</span>);
0708         [err mess] = system(sprintf(<span class="string">'du -h %s.mat'</span>,filename));
0709         <span class="keyword">if</span> err, error(mess); <span class="keyword">end</span>;
0710         fprintf(<span class="string">' %s'</span>,mess);        
0711     <span class="keyword">end</span>
0712     
0713     <span class="keyword">if</span> verbose==2
0714         <span class="comment">% *.fig(s)</span>
0715         fprintf(<span class="string">' ===&gt; Save *.fig files ...\n'</span>);
0716         <span class="keyword">for</span> k=1:fhIdx
0717             saveas(fh(k),strcat(basedir,<span class="string">'/Fig/'</span>,fhName{fhIdx}),<span class="string">'fig'</span>);
0718         <span class="keyword">end</span>        
0719         fprintf(<span class="string">' Done %4.3f sec\n'</span>,toc(tstart));
0720         <span class="comment">%close all;</span>
0721         fhIdx = 0; 
0722     <span class="keyword">end</span> 
0723             
0724 <span class="keyword">end</span>
0725 
0726 varargout = <a href="SetVOutput.html" class="code" title="function vout = SetVOutput( n, varargin )">SetVOutput</a>( nargout, EOBopt,dyn,wav );
0727 fprintf(<span class="string">'End %4.3f sec\n'</span>,toc(tottime));</pre></div>
<hr><address>Generated on Fri 25-Sep-2015 16:20:46 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>